steps:

# build and push the container image
- name: gradle:jdk11-alpine
  entrypoint: gradle
  args: [ 'jib', '--image=${_CONTAINER_IMAGE}:$SHORT_SHA', '--no-configuration-cache' ]
  env:
    - 'GRADLE_OPTS="-Dorg.gradle.daemon=false -Dkotlin.incremental=false"'

# deploy container image to Cloud Run
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:slim'
  entrypoint: gcloud
  args: [
    'run', 'deploy', '${_SERVICE_NAME}',
    '--image', '${_CONTAINER_IMAGE}:$SHORT_SHA',
    '--region', '$LOCATION',
    '--cpu', '${_CPU}',
    '--memory', '${_MEMORY}',
    '--timeout', '${_REQUEST_TIMEOUT}',
  ]
